# Bitrix24 Deal Extractor v2.0

–£–ª—É—á—à–µ–Ω–Ω—ã–π —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä —Å–¥–µ–ª–æ–∫ –∏–∑ Bitrix24 —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π retry –º–µ—Ö–∞–Ω–∏–∑–º–∞, rate limiting –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –ø–æ–∏—Å–∫–∞.

## üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- **503 –æ—à–∏–±–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ API**: Rate limiting —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏  
- **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–¥–µ–ª–∫–∏**: –ü–æ–∏—Å–∫ –ø–æ ID –∏ –Ω–æ–º–µ—Ä—É –≤ —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **–û—Ç–ª–∞–¥–∫–∞**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è 500, 502, 503, 504 –æ—à–∏–±–æ–∫
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1s, 2s, 4s, 8s, 16s
- Rate limiting: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- JSON export —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìã –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### 1. –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å–¥–µ–ª–∫–∞ –ø–æ ID
```bash
python3 get_first_deal.py --deal-id 301721445
```

### 2. –ü–æ–∏—Å–∫ —Å–¥–µ–ª–∫–∏ –ø–æ –Ω–æ–º–µ—Ä—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
```bash
python3 get_first_deal.py --find-number 301721445
```

### 3. –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –Ω–æ–º–µ—Ä–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
```bash
python3 get_first_deal.py --find-all-numbers
```

### 4. –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–∞—è —Å–¥–µ–ª–∫–∞ (–±—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º)
```bash
python3 get_first_deal.py --first-only
```

### 5. –í—Å–µ —Å–¥–µ–ª–∫–∏ —Å –¥–∏–∞–ª–æ–≥–∞–º–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```bash
python3 get_first_deal.py
```

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
python3 get_first_deal.py --debug

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ JSON
python3 get_first_deal.py --output results.json

# –ò —Ç–æ –∏ –¥—Ä—É–≥–æ–µ
python3 get_first_deal.py --deal-id 301721445 --debug --output deal_301721445.json
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤
python3 get_first_deal.py --max-retries 10

# –£–º–µ–Ω—å—à–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
python3 get_first_deal.py --rate-limit 0.2

# –£–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
python3 get_first_deal.py --timeout 60
```

### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä
```bash
python3 get_first_deal.py \
  --deal-id 301721445 \
  --debug \
  --output deal_details.json \
  --max-retries 10 \
  --rate-limit 1.0 \
  --timeout 45
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –≤—ã–≤–æ–¥–∞

```json
{
  "execution_info": {
    "timestamp": "2025-08-07T12:00:00+03:00",
    "duration_seconds": 45.2,
    "api_stats": {
      "total_requests": 15,
      "successful_requests": 13,
      "failed_requests": 2,
      "retry_attempts": 5
    },
    "config": {
      "rate_limit_delay": 0.5,
      "request_timeout": 30,
      "max_retries": 5
    }
  },
  "results": {
    "mode": "specific_deal_by_id",
    "total_deals": 1,
    "deals_with_dialogues": 1,
    "deals": [
      {
        "deal": {
          "ID": "301721445",
          "TITLE": "–°–¥–µ–ª–∫–∞ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é (301721445)",
          "STAGE_ID": "C19:NEW",
          "OPPORTUNITY": "10000",
          "DATE_CREATE": "2025-08-01T10:00:00+03:00"
        },
        "messages": [...],
        "message_count": 15
      }
    ]
  }
}
```

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª `bitrix_extractor.log` —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

```
2025-08-07 12:00:01,234 - INFO - Starting Bitrix24 Deal Extractor v2.0
2025-08-07 12:00:01,456 - INFO - Processing specific deal ID: 301721445
2025-08-07 12:00:01,789 - INFO - Rate limiting delay: 0.50s before crm.deal.get
2025-08-07 12:00:02,123 - INFO - API Request #1: crm.deal.get (attempt 1/6)
2025-08-07 12:00:02,456 - INFO - API Request successful: crm.deal.get
2025-08-07 12:00:02,789 - INFO - Found deal: –°–¥–µ–ª–∫–∞ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é (301721445)
```

## üîç –ü–æ–∏—Å–∫ –Ω–æ–º–µ—Ä–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- `—Å–¥–µ–ª–∫–∞ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—é (301721445)`
- `–æ–±—Ä–∞—â–µ–Ω–∏—é (301721445)`
- `–¥–µ–ª–æ ‚Ññ301721445`
- `(301721445)` - —á–∏—Å–ª–∞ –≤ —Å–∫–æ–±–∫–∞—Ö 6+ —Ü–∏—Ñ—Ä
- `‚Ññ301721445` - —á–∏—Å–ª–∞ –ø–æ—Å–ª–µ ‚Ññ 6+ —Ü–∏—Ñ—Ä

## üö¶ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ API

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
```
=== API Statistics ===
Total requests: 15
Successful: 13
Failed: 2
Retry attempts: 5
Duration: 45.2 seconds
Success rate: 86.7%
```

## ‚ö° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è 503 –æ—à–∏–±–æ–∫:
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ rate limiting**: `--rate-limit 1.0` (1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏)
2. **–£–≤–µ–ª–∏—á—å—Ç–µ retry**: `--max-retries 10`
3. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--deal-id` –≤–º–µ—Å—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Å–¥–µ–ª–æ–∫

### –î–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã:
1. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Å–¥–µ–ª–∫–∞**: `--deal-id 301721445`
2. **–ü–µ—Ä–≤–∞—è —Å–¥–µ–ª–∫–∞**: `--first-only` 
3. **–£–º–µ–Ω—å—à–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–µ–∫**: `--rate-limit 0.2` (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)

### –î–ª—è –æ—Ç–ª–∞–¥–∫–∏:
1. **–ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: `--debug`
2. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: `--output debug.json`
3. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç**: `--timeout 60`

## üìû –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –≤–∞—à–µ–π –∑–∞–¥–∞—á–∏

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ 301721445:
```bash
# –ü—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ ID
python3 get_first_deal.py --deal-id 301721445 --debug --output deal_301721445.json

# –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏/—Ç–µ–∫—Å—Ç–µ
python3 get_first_deal.py --find-number 301721445 --debug --output found_deals.json

# –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
python3 get_first_deal.py --deal-id 301721445 --rate-limit 2.0 --max-retries 10 --timeout 60
```